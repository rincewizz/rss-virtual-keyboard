(()=>{"use strict";class e{constructor({code:e,langKey:t,currentLang:i}){this.code=e,this.langKey=t,this.currentLang=i}getKeySymbol(e){return this.langKey[this.currentLang].icon?this.langKey[this.currentLang].icon:e&&this.langKey[this.currentLang].symbol?this.langKey[this.currentLang].symbol:e&&e.shiftKey?this.langKey[this.currentLang].shiftKey:e&&e.capsLock?this.langKey[this.currentLang].key.toUpperCase():this.langKey[this.currentLang].key}changeLanguage(e){this.currentLang=e,this.keyEl.querySelector(".key__main").innerHTML=this.getKeySymbol()}createButton(){return this.keyEl=document.createElement("button"),this.keyEl.classList.add("keyboard__key","key",`key--${this.code.toLowerCase()}`),this.keyEl.innerHTML=`<span class="key__main">${this.getKeySymbol()}</span>`,this.keyEl.keyObj=this,this.keyEl}setText(e){this.keyEl.innerHTML=`<span class="key__main">${e}</span>`}setAnimation(e){this.animation=e}getAnimation(){return this.animation}}const t=new class{constructor({layout:e,langs:t}){this.layout=e,this.keys={},this.langs=t,this.currentLang="en",this.capsLock=!1}getLangSettings(){return localStorage.getItem("lang")||this.currentLang}setLangSettings(e){localStorage.setItem("lang",e),this.currentLang=e}init(){this.currentLang=this.getLangSettings(),this.render(),document.body.addEventListener("keydown",this.keyDownHandler.bind(this)),document.body.addEventListener("keyup",this.keyUpHandler.bind(this)),this.keyboardEl.addEventListener("mousedown",this.mouseDownHandler.bind(this)),this.keyboardEl.addEventListener("mouseup",this.mouseUpHandler.bind(this)),this.keyboardEl.addEventListener("mouseleave",this.mouseLeaveHandler.bind(this))}render(){this.title=document.createElement("h1"),this.title.innerHTML="Virtual Keyboard",document.body.append(this.title),this.textareaEl=document.createElement("textarea"),this.textareaEl.setAttribute("rows",15),this.textareaEl.classList.add("textarea"),this.keyboardEl=document.createElement("div"),this.keyboardEl.classList.add("keyboard"),document.body.append(this.textareaEl),document.body.append(this.keyboardEl);for(let t=0;t<this.layout.length;t+=1){const i=document.createElement("div");i.classList.add("keyboard__row"),this.keyboardEl.append(i);for(let s=0;s<this.layout[t].length;s+=1){const y=this.layout[t][s],n={en:this.langs.en[y],ru:this.langs.ru[y]},a=new e({code:y,langKey:n,currentLang:this.currentLang});this.keys[y]=a,i.append(a.createButton())}}this.osInfo=document.createElement("div"),this.changeLangInfo=document.createElement("div"),document.body.append(this.osInfo),document.body.append(this.changeLangInfo),this.osInfo.outerHTML='<div class="os-info">Клавиатура создана в операционной системе Arch Linux</div>',this.changeLangInfo.outerHTML='<div class="change-lang-info">Для переключения языка: <b>Ctrl + Alt</b></div>'}keyDownHandler(e){this.keys[e.code]&&this.pressKey(this.keys[e.code],e)}keyUpHandler(e){this.keys[e.code]&&this.unpressKey(this.keys[e.code],e)}mouseDownHandler(e){const t=e.target.closest(".key");if(t&&(this.mouseTarget=t,this.pressKey(t.keyObj,e),!["Shift","Ctrl","Alt","Meta","CapsLock"].includes(t.keyObj.langKey[this.currentLang].key))){const i=()=>{this.timerRepeater=setTimeout((()=>{this.pressKey(t.keyObj,e),i()}),35)};this.timerDelay=setTimeout(i,500)}}mouseUpHandler(e){this.mouseUnpress(e)}mouseLeaveHandler(e){this.mouseUnpress(e)}mouseUnpress(e){const t=this.mouseTarget;t&&(this.unpressKey(t.keyObj,e),clearTimeout(this.timerDelay),clearTimeout(this.timerRepeater))}pressKey(e,t){if(this.textareaEl.focus(),!e.keyEl.classList.contains("key--active")){e.keyEl.classList.add("key--active"),e.setAnimation(!0);const t=i=>{"::before"===i.pseudoElement&&(e.keyEl.classList.contains("key--active")&&e.setAnimation(!1),e.keyEl.removeEventListener("transitionend",t))};e.keyEl.addEventListener("transitionend",t)}const i={capsLock:this.capsLock,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,ctrlKey:t.ctrlKey};if(["Shift","Ctrl","Alt","Meta","CapsLock","Delete","Backspace","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.langKey[this.currentLang].key)||t.ctrlKey||(this.printText(e.getKeySymbol(i)),t.preventDefault()),"CapsLock"!==e.langKey[this.currentLang].key&&"Shift"!==e.langKey[this.currentLang].key||("CapsLock"===e.langKey[this.currentLang].key&&(this.capsLock?e.keyEl.classList.remove("key--on"):e.keyEl.classList.add("key--on")),this.switchUpperCase(e.langKey[this.currentLang].key)),"Ctrl"!==e.langKey[this.currentLang].key&&"Alt"!==e.langKey[this.currentLang].key||i.ctrlKey&&i.altKey&&this.changeLanguage(),"Delete"===e.langKey[this.currentLang].key){const{selectionStart:e}=this.textareaEl;let{selectionEnd:i}=this.textareaEl;e===i&&(i+=1),this.textareaEl.setRangeText("",e,i,"start"),t.preventDefault()}if("Backspace"===e.langKey[this.currentLang].key){let{selectionStart:e}=this.textareaEl;const{selectionEnd:i}=this.textareaEl;e===i&&e>0&&(e-=1),this.textareaEl.setRangeText("",e,i,"start"),t.preventDefault()}if("ArrowLeft"===e.langKey[this.currentLang].key&&(this.textareaEl.selectionStart>0&&(this.textareaEl.selectionStart-=1,this.textareaEl.selectionEnd=this.textareaEl.selectionStart),t.preventDefault()),"ArrowRight"===e.langKey[this.currentLang].key&&(this.textareaEl.selectionStart+=1,this.textareaEl.selectionEnd=this.textareaEl.selectionStart,t.preventDefault()),"ArrowDown"===e.langKey[this.currentLang].key){const e=this.textareaEl.value.split("\n"),{selectionStart:i}=this.textareaEl;let s=0,y=i,n=0;for(let t=0;t<e.length;t+=1){if(n+=e[t].length,e[t].length>=y){s=t;break}y-=e[t].length+1}void 0===e[s+1]?n=this.textareaEl.value.length:y<=e[s+1].length?n+=y+s+1:n+=e[s+1].length+s+1,this.textareaEl.selectionStart=n,this.textareaEl.selectionEnd=n,t.preventDefault()}if("ArrowUp"===e.langKey[this.currentLang].key){const e=this.textareaEl.value.split("\n"),{selectionStart:i}=this.textareaEl;let s=0,y=i,n=0;for(let t=0;t<e.length;t+=1){if(e[t].length>=y){s=t;break}n+=e[t].length,y-=e[t].length+1}void 0===e[s-1]?n=0:y<=e[s-1].length?n+=-e[s-1].length+y+s-1:n+=s-1,this.textareaEl.selectionStart=n,this.textareaEl.selectionEnd=n,t.preventDefault()}}unpressKey(e){if(e.keyEl.classList.contains("key--active")&&!e.animation)e.keyEl.classList.remove("key--active");else if(e.keyEl.classList.contains("key--active")&&e.animation){const t=i=>{"::before"===i.pseudoElement&&(e.keyEl.classList.contains("key--active")&&(e.keyEl.classList.remove("key--active"),e.setAnimation(!1)),e.keyEl.removeEventListener("transitionend",t))};e.keyEl.addEventListener("transitionend",t)}"Shift"===e.langKey[this.currentLang].key&&(this.shift=!1),"Shift"===e.langKey[this.currentLang].key&&this.switchUpperCase(!1)}printText(e){const{selectionStart:t,selectionEnd:i}=this.textareaEl;this.textareaEl.setRangeText(e,t,i,"end")}switchUpperCase(e){"CapsLock"===e&&(this.capsLock=!this.capsLock),"Shift"===e&&(this.shift=!0),Object.values(this.keys).forEach((e=>{e.langKey[this.currentLang].shiftKey&&(this.shift?e.setText(e.langKey[this.currentLang].shiftKey):this.capsLock?e.setText(e.langKey[this.currentLang].key.toUpperCase()):e.setText(e.langKey[this.currentLang].key))}))}changeLanguage(){"en"===this.currentLang?this.setLangSettings("ru"):this.setLangSettings("en"),Object.values(this.keys).forEach((e=>{e.changeLanguage(this.currentLang)}))}}({layout:[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Delete"],["Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backspace"],["CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash","Enter"],["ShiftLeft","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ArrowUp","ShiftRight"],["ControlLeft","MetaLeft","AltLeft","Space","AltRight","ArrowLeft","ArrowDown","ArrowRight","ControlRight"]],langs:{en:{Backquote:{key:"`",shiftKey:"~"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},Digit0:{key:"0",shiftKey:")"},Minus:{key:"-",shiftKey:"_"},Equal:{key:"=",shiftKey:"+"},Backspace:{key:"Backspace",shiftKey:null},Delete:{key:"Delete",shiftKey:null},Tab:{key:"Tab",shiftKey:null,symbol:"\t"},KeyQ:{key:"q",shiftKey:"Q"},KeyW:{key:"w",shiftKey:"W"},KeyE:{key:"e",shiftKey:"E"},KeyR:{key:"r",shiftKey:"R"},KeyT:{key:"t",shiftKey:"T"},KeyY:{key:"y",shiftKey:"Y"},KeyU:{key:"u",shiftKey:"U"},KeyI:{key:"i",shiftKey:"I"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},BracketLeft:{key:"[",shiftKey:"{"},BracketRight:{key:"]",shiftKey:"}"},Enter:{key:"Enter",shiftKey:null,symbol:"\n"},CapsLock:{key:"CapsLock",shiftKey:null},KeyA:{key:"a",shiftKey:"A"},KeyS:{key:"s",shiftKey:"S"},KeyD:{key:"d",shiftKey:"D"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},Semicolon:{key:";",shiftKey:":"},Quote:{key:"'",shiftKey:'"'},Backslash:{key:"\\",shiftKey:"|"},ShiftLeft:{key:"Shift",shiftKey:null},IntlBackslash:{key:"<",shiftKey:">"},KeyZ:{key:"z",shiftKey:"Z"},KeyX:{key:"x",shiftKey:"X"},KeyC:{key:"c",shiftKey:"C"},KeyV:{key:"v",shiftKey:"V"},KeyB:{key:"b",shiftKey:"B"},KeyN:{key:"n",shiftKey:"N"},KeyM:{key:"m",shiftKey:"M"},Comma:{key:",",shiftKey:"<"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},ShiftRight:{key:"Shift",shiftKey:null},ControlLeft:{key:"Ctrl",shiftKey:null},AltLeft:{key:"Alt",shiftKey:null},Space:{key:" ",shiftKey:null},AltRight:{key:"Alt",shiftKey:null},ControlRight:{key:"Ctrl",shiftKey:null},ArrowLeft:{key:"ArrowLeft",shiftKey:null,icon:"←"},ArrowUp:{key:"ArrowUp",shiftKey:null,icon:"↑"},ArrowDown:{key:"ArrowDown",shiftKey:null,icon:"↓"},ArrowRight:{key:"ArrowRight",shiftKey:null,icon:"→"},MetaLeft:{key:"Meta",shiftKey:null},MetaRight:{key:"Meta",shiftKey:null}},ru:{CapsLock:{key:"CapsLock",shiftKey:null},Backquote:{key:"ё",shiftKey:"Ё"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:'"'},Digit3:{key:"3",shiftKey:"№"},Digit4:{key:"4",shiftKey:";"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:":"},Digit7:{key:"7",shiftKey:"?"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},Digit0:{key:"0",shiftKey:")"},Minus:{key:"-",shiftKey:"_"},Equal:{key:"=",shiftKey:"+"},Backspace:{key:"Backspace",shiftKey:null},Delete:{key:"Delete",shiftKey:null},Tab:{key:"Tab",shiftKey:null,symbol:"\t"},KeyQ:{key:"й",shiftKey:"Й"},KeyW:{key:"ц",shiftKey:"Ц"},KeyE:{key:"у",shiftKey:"У"},KeyR:{key:"к",shiftKey:"К"},KeyT:{key:"е",shiftKey:"Е"},KeyY:{key:"н",shiftKey:"Н"},KeyU:{key:"г",shiftKey:"Г"},KeyI:{key:"ш",shiftKey:"Ш"},KeyO:{key:"щ",shiftKey:"Щ"},KeyP:{key:"з",shiftKey:"З"},BracketLeft:{key:"х",shiftKey:"Х"},BracketRight:{key:"ъ",shiftKey:"Ъ"},Enter:{key:"Enter",shiftKey:null,symbol:"\n"},KeyA:{key:"ф",shiftKey:"Ф"},KeyS:{key:"ы",shiftKey:"Ы"},KeyD:{key:"в",shiftKey:"В"},KeyF:{key:"а",shiftKey:"А"},KeyG:{key:"п",shiftKey:"П"},KeyH:{key:"р",shiftKey:"Р"},KeyJ:{key:"о",shiftKey:"О"},KeyK:{key:"л",shiftKey:"Л"},KeyL:{key:"д",shiftKey:"Д"},Semicolon:{key:"ж",shiftKey:"Ж"},Quote:{key:"э",shiftKey:"Э"},Backslash:{key:"\\",shiftKey:"/"},ShiftLeft:{key:"Shift",shiftKey:null},IntlBackslash:{key:"/",shiftKey:"|"},KeyZ:{key:"я",shiftKey:"Я"},KeyX:{key:"ч",shiftKey:"Ч"},KeyC:{key:"с",shiftKey:"С"},KeyV:{key:"м",shiftKey:"М"},KeyB:{key:"и",shiftKey:"И"},KeyN:{key:"т",shiftKey:"Т"},KeyM:{key:"ь",shiftKey:"Ь"},Comma:{key:"б",shiftKey:"Б"},Period:{key:"ю",shiftKey:"Ю"},Slash:{key:".",shiftKey:","},ShiftRight:{key:"Shift",shiftKey:null},ControlLeft:{key:"Ctrl",shiftKey:null},AltLeft:{key:"Alt",shiftKey:null},Space:{key:" ",shiftKey:null},AltRight:{key:"Alt",shiftKey:null},ControlRight:{key:"Ctrl",shiftKey:null},ArrowLeft:{key:"ArrowLeft",shiftKey:null,icon:"←"},ArrowUp:{key:"ArrowUp",shiftKey:null,icon:"↑"},ArrowDown:{key:"ArrowDown",shiftKey:null,icon:"↓"},ArrowRight:{key:"ArrowRight",shiftKey:null,icon:"→"},MetaLeft:{key:"Meta",shiftKey:null},MetaRight:{key:"Meta",shiftKey:null}}}});t.init()})();